---
layout: default
title: Developer Guide
nav_order: 3
---

## Overview

This project uses three environments below:

- **Development**: local machine
- **Preview**: Vercel preview env (related ADR: [ADR-0001](https://github.com/Rindrics/mikazuki-munechika/blob/main/adr/0001-use-nextjs.md))
- [**Production**](https://stock-assessment.learn-to.live)

## Setup your Development environment

### Prerequisites

- [Node.js](https://nodejs.org/en) 24 or later
- [Docker](https://www.docker.com/) (for Supabase local server)

### Port Allocation

This project uses ports in the 30300 series:

| Port  | Service                   |
| ----- | ------------------------- |
| 30300 | Next.js dev server        |
| 30301 | Grafana                   |
| 30303 | Jekyll (docs)             |
| 30304 | OTel Collector Prometheus |
| 30317 | OTel Collector gRPC       |
| 30318 | OTel Collector HTTP       |

### Setup

#### Install dependencies

```sh
# create local envfile
cp .env.local.template .env.local

# install dependencies
pnpm install

# start Supabase local server
pnpm run start-db
```

Configure `.env.local` with variables shown by the command below:

```sh
# see Supabase variables
pnpm run status-db
```

#### Run database migrations

To apply migrations, run command below:

```sh
pnpm run migrate:local
```

> `pnpm run migrate`is for **production** deployments only. It pushes migrations to the remote Supabase project. For local development, always use `reset-db` or `migrate:local`.

#### Create initial users

Run the user creation script to create test users:

```sh
pnpm run create-users
```

See [this file](https://github.com/Rindrics/mikazuki-munechika/blob/main/scripts/create-users.ts) what will be created by this command.

#### Start the Next.js app

```sh
pnpm dev
```

### OpenTelemetry Setup (Optional)

To enable local tracing with OpenTelemetry:

1. Start the OTel infrastructure:

   ```sh
   pnpm run otel:start
   ```

1. Add the following to your `.env.local`:

   ```sh
   # OTel endpoint (local)
   OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:30318

   # Enable verbose spans (recommended for development)
   NEXT_OTEL_VERBOSE=1
   ```

1. View metrics and traces in Grafana: <http://localhost:30301>

See [ADR 0028](https://github.com/Rindrics/mikazuki-munechika/blob/main/adr/0028-opentelemetry-grafana-integration.md) for details.

## Documentation

This project has two types of documents:

- [References](/references): helps building common understanding of the domain knowledge among stakeholders. They are generated by [`TypeDoc`](https://typedoc.org/)
- [Guides](/docs): helps understand this entire project

These two types of documents are hosted by [GitHub pages](https://docs.github.com/en/pages)

To Serve GitHub Pages on local, run command below:

```sh
cd docs && make pages
```

If you want to update references, you should run:

```sh
pnpm run docs:generate
```

## Appendix

Blog posts about this app: <https://rindrics.com/tags/mikazuki-munechika/>
(Note: `mikazuki-munechika` is the development codename, named after the Japanese sword "三日月宗近")
